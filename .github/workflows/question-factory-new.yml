name: 'App Factory Trigger'

on:
  schedule:
    - cron: '0 */2 * * *' # æ ¸å¿ƒä¿®æ­£ï¼šæ¯2å°æ—¶è‡ªåŠ¨è§¦å‘ä¸€æ¬¡ï¼ˆå…¨å¤©12æ¬¡ï¼‰
  workflow_dispatch:      # ä¿æŒæ‰‹åŠ¨è§¦å‘åŠŸèƒ½

jobs:
  trigger-factory:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Run App Factory Trigger
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_KEY: ${{ secrets.SUPABASE_SERVICE_KEY }}
        # ä¼˜åŒ–ï¼šé€šè¿‡ç®€å•çš„å¾ªç¯ï¼Œæ¯æ¬¡ä»»åŠ¡è‡ªåŠ¨è¿ç»­è§¦å‘ 5 æ¬¡è¯·æ±‚
        # è¿™æ ·æ¯æ¬¡ä»»åŠ¡èƒ½äº§å‡º 50 é¢˜ï¼Œä¸”æ¯ 10 é¢˜ç‹¬ç«‹ä¿å­˜ï¼Œæå…¶å®‰å…¨ç¨³å®š
        run: |
          for i in {1..5}; do
            echo "ğŸš€ æ­£åœ¨æ‰§è¡Œç¬¬ $i è½®ç”Ÿäº§ä»»åŠ¡..."
            node scripts/app_factory_trigger.js
            sleep 5 # æ¯æ¬¡è¯·æ±‚é—´éš”5ç§’ï¼Œé˜²æ­¢ API é¢‘ç‡è¿‡å¿«
          done